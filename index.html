<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Odpoƒçet k prvn√≠mu pivu üç∫</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    background: linear-gradient(45deg, #ffcc00, #ff6600);
    font-family: Comic Sans MS, cursive;
    margin: 0;
}

.container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
    text-align: center;
}

h1 {
    font-size: 70px;
}

.tables {
    display: flex;
    gap: 30px;
    justify-content: center;
    flex-wrap: wrap;
}

table {
    border-collapse: collapse;
    background: white;
    width: 500px;
    border-radius: 15px;
    overflow: hidden;
}

th, td {
    border: 1px solid #ccc;
    padding: 6px;
}

input {
    width: 80px;
}

button {
    padding: 4px 10px;
    cursor: pointer;
}

.message {
    margin: 30px auto;
    padding: 20px;
    background: white;
    border-radius: 15px;
    font-size: 22px;
    max-width: 800px;
    word-wrap: break-word;
}

canvas {
    background: white;
    border-radius: 20px;
    padding: 20px;
    margin-top: 30px;
}
</style>
</head>

<body>
<div class="container">

<h1 id="time">00:00:00</h1>
<p>üç∫ Odpoƒçet k prvn√≠mu pivu üç∫</p>

<div class="tables">
    <div>
        <h2>Luk√°≈°</h2>
        <table id="lukasTable"></table>
    </div>

    <div>
        <h2>Martin</h2>
        <table id="martinTable"></table>
    </div>
</div>

<div class="message" id="msg">---</div>

<h2>üìà V√Ωvoj v√°hy</h2>
<canvas id="weightChart" width="1000" height="400"></canvas>

</div>

<script>
/************ THINGSPEAK ************/
const CHANNEL_ID = "3249143";
const WRITE_API_KEY = "H753ZAUO7U3LT3J6";

/************ HLA≈†KY ************/
const messages = [
    "Forma na l√©to je zase o krok d√°l üòé",
    "To pivo se samo nevypilo üç∫",
    "Tren√©r by z tebe radost nemƒõl üòà",
    "Zimn√≠ objem se utrhl ze ≈ôetƒõzu üê∑",
    "Aspo≈à m√°≈° rezervy na hor≈°√≠ ƒçasy üòÖ",
    "V√Ω≈æivov√Ω poradce pr√°vƒõ omdlel ü§°"
];

/************ ODPORƒåET ************/
function endOfFebruary() {
    const y = new Date().getFullYear();
    return new Date(y, 2, 0, 23, 59, 59);
}

setInterval(() => {
    const diff = endOfFebruary() - new Date();
    const h = Math.floor(diff / 1000 / 60 / 60);
    const m = Math.floor(diff / 1000 / 60) % 60;
    const s = Math.floor(diff / 1000) % 60;
    document.getElementById("time").innerText =
        `${h}:${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
}, 1000);

/************ TABULKY ************/
function makeTable(id, name) {
    const t = document.getElementById(id);
    t.innerHTML = "<tr><th>Den</th><th>V√°ha</th><th></th></tr>";
    for (let d = 1; d <= 29; d++) {
        t.innerHTML += `
        <tr>
            <td>${d}.2.</td>
            <td><input type="number" id="${name}${d}"></td>
            <td><button onclick="save('${name}',${d})">‚úî</button></td>
        </tr>`;
    }
}
makeTable("lukasTable", "lukas");
makeTable("martinTable", "martin");

/************ ULO≈ΩEN√ç ************/
function save(name, day) {
    const val = document.getElementById(name + day).value;
    if (!val) return alert("Zadej v√°hu");

    const field = name === "lukas" ? 1 : 2;

    fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field${field}=${val}&status=${name}-${day}`);

    document.getElementById("msg").innerText =
        messages[Math.floor(Math.random() * messages.length)];

    loadChart();
}

/************ GRAF ************/
let chart;
function loadChart() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=60`)
        .then(r => r.json())
        .then(d => {
            const labels = d.feeds.map(f => f.created_at.slice(5,10));
            const lukas = d.feeds.map(f => f.field1);
            const martin = d.feeds.map(f => f.field2);

            if (chart) chart.destroy();
            chart = new Chart(document.getElementById("weightChart"), {
                type: "line",
                data: {
                    labels,
                    datasets: [
                        { label: "Luk√°≈°", data: lukas },
                        { label: "Martin", data: martin }
                    ]
                }
            });
        });
}
loadChart();
</script>

</body>
</html>
