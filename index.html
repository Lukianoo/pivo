<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Odpoƒçet k prvn√≠mu pivu üç∫</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    background:linear-gradient(45deg,#ffcc00,#ff6600);
    font-family:"Comic Sans MS", cursive;
    margin:0;
    color:#333;
}
.container{
    max-width:1200px;
    margin:auto;
    padding:15px;
    text-align:center;
}
h1{font-size:48px;margin:20px 0}
.tables{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
    justify-content:center;
}
.table-box{max-width:520px;width:100%}
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
th,td{
    border:1px solid #ccc;
    padding:12px;
}
th{background:#ff9900;color:white}
.today{background:#ffe066;font-weight:bold}
input{
    width:100%;
    padding:8px;
    font-size:16px;
}
button{
    padding:8px 14px;
    background:#ff9900;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#ff7700}
button:disabled{opacity:.6;cursor:not-allowed}

/* HL√Å≈†KA */
.message{
    margin:20px auto;
    padding:20px;
    background:white;
    border-radius:15px;
    font-size:22px;
    max-width:900px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    animation:pulse 2.5s infinite;
}
@keyframes pulse{
    0%   { transform:scale(1); }
    50%  { transform:scale(1.04); }
    100% { transform:scale(1); }
}

.message.show{
    opacity:1;
    transform:translateY(0);
}

.chart-container{
    max-width:1000px;
    height:400px;
    margin:auto;
    background:white;
    border-radius:15px;
    padding:20px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
canvas{width:100%;height:100%}
</style>
</head>

<body>
<div class="container">
    
    <p style="font-size:24px">üç∫ Do konca √∫nora n√°m zb√Ωv√° üç∫</p>
<h1 id="time">00:00:00</h1>
    <div class="message" id="msg">---</div>
    <div class="tables">
        <div class="table-box">
            <h2>Luk√°≈°</h2>
            <table id="lukasTable"></table>
        </div>
        <div class="table-box">
            <h2>Martin</h2>
            <table id="martinTable"></table>
        </div>
    </div>

    

    <h2>üìà V√Ωvoj v√°hy ‚Äì √∫nor</h2>
    <div class="chart-container">
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const CHANNEL_ID="3249143";
const WRITE_API_KEY="H753ZAUO7U3LT3J6";
const READ_API_KEY="1RDF4Q2Y54BGZSNB";

const MONTH=1; // √∫nor
const year=new Date().getFullYear();
const lastDay=new Date(year,MONTH+1,0).getDate();
const today=new Date().getDate();
const endDate=new Date(year,MONTH,lastDay,23,59,59);

/* HL√Å≈†KY */
const messages={
    lukas:[
        "Luk√°≈°i‚Ä¶ forma se kut√°l√≠ üç∫",
        "ƒåinky pl√°ƒçou üòà",
        "Tohle pivo samo neshod√≠≈°",
        "Aspo≈à m√°≈° stabilitu üòè"
    ],
    martin:[
        "Martine, v√°ha mluv√≠ üìà",
        "To nen√≠ r≈Øst sval≈Ø üòÖ",
        "Ledniƒçka m√° radost",
        "Forma ≈°la na dovolenou"
    ]
};
let currentPerson = "lukas"; // v√Ωchoz√≠
let msgIndex = 0;

/* ODPOƒåET */
function updateCountdown(){
    const diff=endDate-new Date();
    if(diff<=0){time.innerText="ƒåAS VYPR≈†EL! üç∫";return;}
    const h=Math.floor(diff/36e5);
    const m=Math.floor(diff%36e5/6e4);
    const s=Math.floor(diff%6e4/1e3);
    time.innerText=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
setInterval(updateCountdown,1000);
updateCountdown();

/* TABULKY */
function makeTable(id,name){
    let html=`<tr><th>Den</th><th>V√°ha</th><th></th></tr>`;
    for(let d=1;d<=lastDay;d++){
        html+=`
        <tr class="${d===today?"today":""}">
            <td>${d}.2.${d===today?" (dnes)":""}</td>
            <td><input id="${name}${d}" type="number" step="0.1"></td>
            <td><button onclick="save('${name}',${d})">‚úî Ulo≈æit</button></td>
        </tr>`;
    }
    document.getElementById(id).innerHTML=html;
}
makeTable("lukasTable","lukas");
makeTable("martinTable","martin");

/* HL√Å≈†KA */
function showMessage(text){
    document.getElementById("msg").innerText = text;
}
function startMessageRotation(){
    const el = document.getElementById("msg");

    setInterval(() => {
        const arr = messages[currentPerson];
        el.innerText = arr[msgIndex % arr.length];
        msgIndex++;
    }, 5000);
}



/* ULO≈ΩEN√ç */
window.save=function(name,day){
    const input=document.getElementById(name+day);
    const value=input.value;
    if(!value||value<40||value>200){
        alert("Zadej v√°hu 40‚Äì200 kg");
        return;
    }
    const field=name==="lukas"?1:2;
    fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field${field}=${value}`)
    .then(r=>r.text())
    .then(id=>{
        if(id!=="0"){
            currentPerson = name;
msgIndex = 0;
showMessage(messages[name][0]);

            setTimeout(loadAll,5200);
        }
    });
};

/* DATA + GRAF */
let chart=null;
const chartEl=document.getElementById("chart");

function loadAll(){
fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=300`)
.then(r=>r.json())
.then(data=>{
    const labels=[],ld=[],md=[];
    for(let d=1;d<=lastDay;d++){
        labels.push(d+".2");
        let lv=null,mv=null;
        for(let i=data.feeds.length-1;i>=0;i--){
            const f=data.feeds[i];
            const dt=new Date(f.created_at);
            if(dt.getMonth()===MONTH && dt.getDate()===d){
                if(lv===null && f.field1) lv=f.field1;
                if(mv===null && f.field2) mv=f.field2;
            }
        }
        if(lv) document.getElementById("lukas"+d).value=lv;
        if(mv) document.getElementById("martin"+d).value=mv;
        ld.push(lv?+lv:null);
        md.push(mv?+mv:null);
    }
    if(chart) chart.destroy();
    chart=new Chart(chartEl,{
        type:"line",
        data:{
            labels,
            datasets:[
                {label:"Luk√°≈°",data:ld,borderColor:"#ff4444",spanGaps:true},
                {label:"Martin",data:md,borderColor:"#4488ff",spanGaps:true}
            ]
        },
        options:{responsive:true,maintainAspectRatio:false}
    });
});
}
loadAll();
startMessageRotation();

});
</script>
</body>
</html>
