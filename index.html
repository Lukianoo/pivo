<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Odpoƒçet k prvn√≠mu pivu üç∫</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    background: linear-gradient(45deg, #ffcc00, #ff6600);
    font-family: Comic Sans MS, cursive;
    margin: 0;
}

.container {
    max-width: 1200px;
    margin: auto;
    padding: 15px;
    text-align: center;
}

h1 { font-size: 48px; }

.tables {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
}

.table-box {
    width: 100%;
    max-width: 520px;
}

table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 15px;
    overflow: hidden;
}

th, td {
    border: 1px solid #ccc;
    padding: 6px;
    font-size: 14px;
}

input {
    width: 100%;
    font-size: 16px;
}

button {
    padding: 6px 12px;
    font-size: 16px;
}

.message {
    margin: 20px auto;
    padding: 15px;
    background: white;
    border-radius: 15px;
    font-size: 18px;
    max-width: 900px;
}

canvas {
    width: 100% !important;
    max-width: 1000px;
    height: auto !important;
    background: white;
    border-radius: 15px;
    padding: 10px;
}
</style>
</head>

<body>
<div class="container">

<h1 id="time">00:00:00</h1>
<p>üç∫ Odpoƒçet k prvn√≠mu pivu üç∫</p>

<div class="tables">
    <div class="table-box">
        <h2>Luk√°≈°</h2>
        <table id="lukasTable"></table>
    </div>
    <div class="table-box">
        <h2>Martin</h2>
        <table id="martinTable"></table>
    </div>
</div>

<div class="message" id="msg">---</div>

<h2>üìà V√Ωvoj v√°hy</h2>
<canvas id="weightChart"></canvas>

</div>

<script>
/************ THINGSPEAK ************/
const CHANNEL_ID = "3249143";
const WRITE_API_KEY = "H753ZAUO7U3LT3J6";

/************ HLA≈†KY ************/
const messages = [
    "Forma na l√©to se pomalu r√Ωsuje üòé",
    "To pivo za to st√°lo üç∫",
    "Tren√©r pr√°vƒõ breƒç√≠ üòà",
    "Zimn√≠ objem pokraƒçuje üê∑",
    "V√Ω≈æivov√Ω poradce omdlel ü§°",
    "Aspo≈à nejsi kost a k≈Ø≈æe üòÖ"
];

/************ ODPORƒåET ************/
function endOfFebruary() {
    const y = new Date().getFullYear();
    return new Date(y, 2, 0, 23, 59, 59);
}
setInterval(() => {
    const d = endOfFebruary() - new Date();
    document.getElementById("time").innerText =
        `${Math.floor(d/36e5)}:${Math.floor(d/6e4)%60}:${Math.floor(d/1e3)%60}`;
}, 1000);

/************ TABULKY ************/
function makeTable(id, name) {
    const t = document.getElementById(id);
    t.innerHTML = "<tr><th>Den</th><th>V√°ha</th><th></th></tr>";
    for (let d = 1; d <= 29; d++) {
        t.innerHTML += `
        <tr>
            <td>${d}.2.</td>
            <td><input type="number" id="${name}${d}"></td>
            <td><button onclick="save('${name}',${d})">‚úî</button></td>
        </tr>`;
    }
}
makeTable("lukasTable","lukas");
makeTable("martinTable","martin");

/************ ULO≈ΩEN√ç ************/
function save(name, day) {
    const val = document.getElementById(name+day).value;
    if (!val) return alert("Zadej v√°hu");
    const field = name === "lukas" ? 1 : 2;

    fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field${field}=${val}&status=${name}-${day}`);

    document.getElementById("msg").innerText =
        messages[Math.floor(Math.random()*messages.length)];

    loadAll();
}

/************ NAƒåTEN√ç DAT ************/
function loadAll() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=100`)
    .then(r=>r.json())
    .then(d=>{
        const labels=[], l=[], m=[];
        d.feeds.forEach(f=>{
            if(f.status){
                const [name,day]=f.status.split("-");
                const el=document.getElementById(name+day);
                if(el && f[`field${name==="lukas"?1:2}`]){
                    el.value=f[`field${name==="lukas"?1:2}`];
                }
            }
            labels.push(f.created_at.slice(5,10));
            l.push(f.field1); m.push(f.field2);
        });
        drawChart(labels,l,m);
    });
}

/************ GRAF ************/
let chart;
function drawChart(labels,lukas,martin){
    if(chart) chart.destroy();
    chart=new Chart(weightChart,{
        type:"line",
        data:{labels,
            datasets:[
                {label:"Luk√°≈°",data:lukas},
                {label:"Martin",data:martin}
            ]}
    });
}

loadAll();
</script>

</body>
</html>
