<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OdpoÄet k prvnÃ­mu pivu ğŸº</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    background:linear-gradient(45deg,#ffcc00,#ff6600);
    font-family:"Comic Sans MS", cursive;
    margin:0;
    color:#333;
}
.container{
    max-width:1200px;
    margin:auto;
    padding:15px;
    text-align:center;
}
h1{font-size:48px;margin:20px 0}
h2{margin-top:40px}
.tables{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
    justify-content:center;
}
.table-box{max-width:520px;width:100%}
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
th,td{
    border:1px solid #ccc;
    padding:12px;
    font-size:16px;
}
th{background:#ff9900;color:white}
.today{background:#ffe066;font-weight:bold}
input{
    width:100%;
    padding:10px;
    font-size:16px;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    padding:10px 16px;
    font-size:16px;
    background:#ff9900;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#ff7700}
button:disabled{opacity:.6;cursor:not-allowed}

/* ğŸ”¥ HLÃÅ KA + ANIMACE */
.message{
    margin:30px auto;
    padding:20px;
    background:white;
    border-radius:15px;
    font-size:22px;
    max-width:900px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    opacity:0;
    transform:translateY(20px) scale(.95);
    transition:.4s ease;
}
.message.show{
    opacity:1;
    transform:translateY(0) scale(1);
}
.message.hide{
    opacity:0;
    transform:translateY(-20px) scale(.95);
}

.chart-container{
    max-width:1000px;
    height:400px;
    margin:auto;
    background:white;
    border-radius:15px;
    padding:20px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
canvas{width:100%;height:100%}
</style>
</head>

<body>
<div class="container">
<h1 id="time">00:00:00</h1>
<p style="font-size:24px">ğŸº OdpoÄet k prvnÃ­mu pivu ğŸº</p>

<div class="tables">
    <div class="table-box"><h2>LukÃ¡Å¡</h2><table id="lukasTable"></table></div>
    <div class="table-box"><h2>Martin</h2><table id="martinTable"></table></div>
</div>

<div class="message" id="msg">---</div>

<h2>ğŸ“ˆ VÃ½voj vÃ¡hy â€“ Ãºnor</h2>
<div class="chart-container">
    <canvas id="chart"></canvas>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const CHANNEL_ID="3249143";
const WRITE_API_KEY="H753ZAUO7U3LT3J6";
const READ_API_KEY="1RDF4Q2Y54BGZSNB";

const MONTH=1;
const year=new Date().getFullYear();
const lastDay=new Date(year,MONTH+1,0).getDate();
const today=new Date().getDate();
const endDate=new Date(year,MONTH,lastDay,23,59,59);

/* ğŸ”¥ JINÃ‰ HLÃÅ KY */
const messages={
    lukas:[
        "LukÃ¡Å¡iâ€¦ tohle ti pivo samo neodpije ğŸº",
        "Forma? SpÃ­Å¡ sud ğŸ˜ˆ",
        "AspoÅˆ mÃ¡Å¡ poÅ™Ã¡dnÄ› na Äem sedÄ›t ğŸ˜",
        "ÄŒinky breÄÃ­ v koutÄ› ğŸ¤¡",
        "TrenÃ©r se prÃ¡vÄ› odhlÃ¡sil"
    ],
    martin:[
        "Martine, tichoâ€¦ vÃ¡ha mluvÃ­ ğŸ“ˆ",
        "To nenÃ­ rÅ¯st, to je expanze ğŸ˜…",
        "Pivo se samo nevybÄ›hÃ¡ ğŸº",
        "Forma se nÄ›kam zakulatila",
        "LedniÄka mÃ¡ radost â¤ï¸"
    ]
};

/* ODPOÄŒET */
function updateCountdown(){
    const d=endDate-new Date();
    if(d<=0){time.innerText="ÄŒAS VYPRÅ EL! ğŸº";return;}
    const h=Math.floor(d/36e5),
          m=Math.floor(d%36e5/6e4),
          s=Math.floor(d%6e4/1e3);
    time.innerText=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
setInterval(updateCountdown,1000);updateCountdown();

/* TABULKY */
function makeTable(id,name){
    let html=`<tr><th>Den</th><th>VÃ¡ha</th><th></th></tr>`;
    for(let d=1;d<=lastDay;d++){
        html+=`<tr class="${d===today?"today":""}">
        <td>${d}.2.${d===today?" (dnes)":""}</td>
        <td><input id="${name}${d}" type="number" step="0.1"></td>
        <td><button onclick="save('${name}',${d})">âœ” UloÅ¾it</button></td>
        </tr>`;
    }
    document.getElementById(id).innerHTML=html;
}
makeTable("lukasTable","lukas");
makeTable("martinTable","martin");

/* HLÃÅ KA */
function showMessage(text){
    const el=document.getElementById("msg");
    el.innerText=text;
    el.classList.remove("hide");
    el.classList.add("show");
    setTimeout(()=>{
        el.classList.remove("show");
        el.classList.add("hide");
    },5000);
}

/* ULOÅ½ENÃ */
window.save=function(name,day){
    const input=document.getElementById(name+day);
    const v=input.value;
    if(!v||v<40||v>200){alert("Zadej vÃ¡hu 40â€“200");return;}
    const field=name==="lukas"?1:2;
    fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field${field}=${v}`)
    .then(r=>r.text())
    .then(id=>{
        if(id!=="0"){
            const arr=messages[name];
            showMessage(arr[Math.floor(Math.random()*arr.length)]);
            setTimeout(loadAll,5500);
        }
    });
};

/* DATA + GRAF */
let chart;
function loadAll(){
fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=300`)
.then(r=>r.json())
.then(d=>{
    const l=[],ld=[],md=[];
    for(let i=1;i<=lastDay;i++){
        l.push(i+".2");let lv=null,mv=null;
        d.feeds.slice().reverse().forEach(f=>{
            const dt=new Date(f.created_at);
            if(dt.getMonth()===MONTH&&dt.getDate()===i){
                if(lv===null&&f.field1)lv=f.field1;
                if(mv===null&&f.field2)mv=f.field2;
            }
        });
        if(lv)lukas+i.value=lv;
        if(mv)martin+i.value=mv;
        ld.push(lv?+lv:null);
        md.push(mv?+mv:null);
    }
    if(chart)chart.destroy();
    chart=new Chart(chartEl,{
        type:"line",
        data:{labels:l,datasets:[
            {label:"LukÃ¡Å¡",data:ld,borderColor:"#ff4444",spanGaps:true},
            {label:"Martin",data:md,borderColor:"#4488ff",spanGaps:true}
        ]},
        options:{responsive:true,maintainAspectRatio:false}
    });
});
}
const chartEl=document.getElementById("chart");
loadAll();

});
</script>
</body>
</html>
