<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OdpoÄet k prvnÃ­mu pivu ğŸº</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    background:linear-gradient(45deg,#ffcc00,#ff6600);
    font-family:"Comic Sans MS", cursive;
    margin:0;
    color:#333;
}
.container{
    max-width:1200px;
    margin:auto;
    padding:15px;
    text-align:center;
}
h1{font-size:48px;margin:20px 0}
.tables{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
    justify-content:center;
}
.table-box{max-width:520px;width:100%}
table{
    width:100%;
    border-collapse:collapse;
    background:white;
    border-radius:15px;
    overflow:hidden;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
th,td{
    border:1px solid #ccc;
    padding:12px;
}
th{background:#ff9900;color:white}
.today{background:#ffe066;font-weight:bold}
input{
    width:100%;
    padding:8px;
    font-size:16px;
}
button{
    padding:8px 14px;
    background:#ff9900;
    color:white;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
button:hover{background:#ff7700}

/* HLÃÅ KA */
.message{
    margin:20px auto;
    padding:20px;
    background:white;
    border-radius:15px;
    font-size:22px;
    max-width:900px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
    animation:pulse 2.5s infinite;
}
@keyframes pulse{
    0%   { transform:scale(1); }
    50%  { transform:scale(1.04); }
    100% { transform:scale(1); }
}

.chart-container{
    max-width:1000px;
    height:400px;
    margin:auto;
    background:white;
    border-radius:15px;
    padding:20px;
    box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
canvas{width:100%;height:100%}
</style>
</head>

<body>
<div class="container">

    <p style="font-size:24px">ğŸº Do konce Ãºnora nÃ¡m zbÃ½vÃ¡ ğŸº</p>
    <h1 id="time">00:00:00</h1>

    <div class="message" id="msg">---</div>

    <div class="tables">
        <div class="table-box">
            <h2>LukÃ¡Å¡</h2>
            <table id="lukasTable"></table>
        </div>
        <div class="table-box">
            <h2>Martin</h2>
            <table id="martinTable"></table>
        </div>
    </div>

    <h2>ğŸ“ˆ VÃ½voj vÃ¡hy â€“ Ãºnor</h2>
    <div class="chart-container">
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{

const CHANNEL_ID="3249143";
const WRITE_API_KEY="H753ZAUO7U3LT3J6";
const READ_API_KEY="1RDF4Q2Y54BGZSNB";

const MONTH=1;
const year=new Date().getFullYear();
const lastDay=new Date(year,MONTH+1,0).getDate();
const today=new Date().getDate();
const endDate=new Date(year,MONTH,lastDay,23,59,59);

/* HLÃÅ KY â€“ SPOLEÄŒNÃ‰ */
const messages = [
    // ğŸ˜ˆ LUKÃÅ 
    "LukÃ¡Å¡i suchÃ½ Ãºnor mokrej jen pot ğŸ˜ˆ",
    "LukÃ¡Å¡i pivo nikde nÃ¡lada v mÃ­nusu",
    "LukÃ¡Å¡i svaly ÄekajÃ­ psychika breÄÃ­",
    "LukÃ¡Å¡i abstinujeÅ¡ ale vypadÃ¡Å¡ nasranej",
    "LukÃ¡Å¡i pivo zakÃ¡zanÃ½ utrpenÃ­ povinnÃ½",
    "LukÃ¡Å¡i fitko ano radost ne",
    "LukÃ¡Å¡i sucho v krku sucho v Å¾ivotÄ›",
    "LukÃ¡Å¡i jeÅ¡tÄ› pÃ¡r dnÃ­ bez piva a rupneÅ¡",

    // ğŸ˜ˆ MARTIN
    "Martine vÃ¡ha dolÅ¯ chuÅ¥ zabÃ­jet nahoru ğŸ˜ˆ",
    "Martine pijeÅ¡ vodu z donucenÃ­",
    "Martine suchÃ½ Ãºnor vlhkÃ© oÄi",
    "Martine dieta drÅ¾Ã­ nervy ne",
    "Martine pivo zakÃ¡zÃ¡no nasranost povolena",
    "Martine stÅ™Ã­zlivÃ½ ale jen fyzicky",
    "Martine protein mÃ­sto piva Å¾ivotnÃ­ chyba",
    "Martine abstinence potvrzena ÃºsmÄ›v zruÅ¡en",

    // â˜ ï¸ SPOLEÄŒNÃ‰ ZLO
    "SuchÃ½ Ãºnor nejhorÅ¡Ã­ nÃ¡pad lidstva",
    "Pivo ÄekÃ¡ my trpÃ­me",
    "KaÅ¾dÃ½ den bez piva bolÃ­ vÃ­c neÅ¾ vÄera",
    "StÅ™Ã­zlivost je doÄasnÃ¡ trauma vÄ›ÄnÃ©",
    "Tenhle web existuje jen z nenÃ¡visti",
    "Ãšnor bez piva trest bez soudu",
    "JeÅ¡tÄ› Å¾e bÅ™ezen existuje ğŸºğŸ˜ˆ"
];


let msgIndex = 0;

/* ODPOÄŒET */
function updateCountdown(){
    const diff=endDate-new Date();
    if(diff<=0){time.innerText="ÄŒAS VYPRÅ EL! ğŸº";return;}
    const h=Math.floor(diff/36e5);
    const m=Math.floor(diff%36e5/6e4);
    const s=Math.floor(diff%6e4/1e3);
    time.innerText=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
setInterval(updateCountdown,1000);
updateCountdown();

/* ROTACE HLÃÅ EK */
function startMessageRotation(){
    const el=document.getElementById("msg");
    el.innerText=messages[0];
    msgIndex=1;

    setInterval(()=>{
        el.innerText=messages[msgIndex % messages.length];
        msgIndex++;
    },5000);
}

/* TABULKY */
function makeTable(id,name){
    let html=`<tr><th>Den</th><th>VÃ¡ha</th><th></th></tr>`;
    for(let d=1;d<=lastDay;d++){
        html+=`
        <tr class="${d===today?"today":""}">
            <td>${d}.2.${d===today?" (dnes)":""}</td>
            <td><input id="${name}${d}" type="number" step="0.1"></td>
            <td><button onclick="save('${name}',${d})">âœ” UloÅ¾it</button></td>
        </tr>`;
    }
    document.getElementById(id).innerHTML=html;
}
makeTable("lukasTable","lukas");
makeTable("martinTable","martin");

/* ULOÅ½ENÃ */
window.save=function(name,day){
    const input=document.getElementById(name+day);
    const value=input.value;
    if(!value||value<40||value>200){
        alert("Zadej vÃ¡hu 40â€“200 kg");
        return;
    }
    const field=name==="lukas"?1:2;
    fetch(`https://api.thingspeak.com/update?api_key=${WRITE_API_KEY}&field${field}=${value}`)
    .then(()=>setTimeout(loadAll,1000));
};

/* DATA + GRAF */
let chart=null;
const chartEl=document.getElementById("chart");

function loadAll(){
fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=300`)
.then(r=>r.json())
.then(data=>{
    const labels=[],ld=[],md=[];
    for(let d=1;d<=lastDay;d++){
        labels.push(d+".2");
        let lv=null,mv=null;
        for(let i=data.feeds.length-1;i>=0;i--){
            const f=data.feeds[i];
            const dt=new Date(f.created_at);
            if(dt.getMonth()===MONTH && dt.getDate()===d){
                if(lv===null && f.field1) lv=f.field1;
                if(mv===null && f.field2) mv=f.field2;
            }
        }
        if(lv) document.getElementById("lukas"+d).value=lv;
        if(mv) document.getElementById("martin"+d).value=mv;
        ld.push(lv?+lv:null);
        md.push(mv?+mv:null);
    }
    if(chart) chart.destroy();
    chart=new Chart(chartEl,{
        type:"line",
        data:{
            labels,
            datasets:[
                {label:"LukÃ¡Å¡",data:ld,borderColor:"#ff4444",spanGaps:true},
                {label:"Martin",data:md,borderColor:"#4488ff",spanGaps:true}
            ]
        },
        options:{responsive:true,maintainAspectRatio:false}
    });
});
}

loadAll();
startMessageRotation();

});
</script>
</body>
</html>
